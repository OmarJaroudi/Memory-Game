title	"Memory_Game"	
list	p=16f84A
include "p16f84A.inc"


		c1		EQU	d'12'
		COUNT1	EQU	d'13'
		COUNT2	EQU	d'14'
		SCENE	EQU	d'15'		
		;"Scene" flag is used to indicate which scene we are in
		;there are 4 scenes (Main menu, Mode1,Mode2,Mode3)
		;so we can use 4 bits (1000 = Main menu,0100 = Mode1 etc.)
		;when any of the 4 bits is set to 1, the others are 0

		AC		EQU	d'16'	;indicates address of LCD
		tempA1	EQU	d'17'
		tempA2	EQU	d'18'
		tempB1	EQU	d'19'
		tempB2	EQU	d'20'
		COUNTER	EQU	d'21'
		CARD	EQU	d'22'	;indicates if a card is already open or not

		ORG		0x0
		GOTO 	MAIN

		ORG		0x04
		BTFSC	INTCON,RBIF
		GOTO	RBINT
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;; OUTPUTS AND INPUTS ;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

MAIN	CLRF	SCENE
		BSF		STATUS,RP0
		MOVLW	b'10000111'
		MOVWF	OPTION_REG
		CLRF	TRISA
		MOVLW	b'11110000'
		MOVWF	TRISB
		BCF		STATUS,RP0
		CLRF	INTCON
		BSF		INTCON,GIE
		BSF		INTCON,RBIE
		CLRF	PORTA

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;; INITIALIZATION SEQUENCE ;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

		;FUNCTION SET	
		CALL	DELAY2
		MOVLW	b'00010'
		MOVWF	PORTA
		CALL	ET
		;same data line
		CALL	ET
		MOVLW	b'01000'
		MOVWF	PORTA
		CALL	ET
		
		;DISPLAY ON/OFF
		MOVLW	b'00000'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'01100'
		MOVWF	PORTA
		CALL	ET

		;CLEAR DISPLAY
		CALL	Clear_Display

		;ENTRY MODE SET
		MOVLW	b'00000'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'00110'
		MOVWF	PORTA
		CALL	ET  


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;; IMPLMENETATION ;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

MEMORY_GAME	
		;SET ADDRESS
		MOVLW	b'01000'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'00010'
		MOVWF	PORTA
		CALL	ET

		;M
		CALL	Letter_M

		;E
		CALL	Letter_E

		;M
		CALL	Letter_M

		;O
		CALL	Letter_O

		;R
		MOVLW	b'10101'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10010'
		MOVWF	PORTA
		CALL	ET

		;Y
		MOVLW	b'10101'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'11001'
		MOVWF	PORTA
		CALL	ET

		;blank space
		CALL	Blank_Space

		;G
		MOVLW	b'10100'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10111'
		MOVWF	PORTA
		CALL	ET

		;A
		MOVLW	b'10100'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10001'
		MOVWF	PORTA
		CALL	ET

		;M
		CALL	Letter_M

		;E
		CALL	Letter_E
		
		;delaying the welcome message for about 2.5 seconds
		MOVLW	d'50'
		MOVWF	c1
Label	CALL	DELAY2
		DECFSZ	c1,f
		GOTO Label
		

MAIN_MENU
		;CLEAR DISPLAY
		CALL	Clear_Display

		;SET ADDRESS
		MOVLW	b'01000'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'00000'
		MOVWF	PORTA
		CALL	ET
		
		MOVLW	b'1000'
		MOVWF	SCENE	; we are in the "main menu" scene
		MOVLW	d'6'
		MOVWF	AC

		;M
		CALL	Letter_M
		;O
		CALL	Letter_O
		;D
		MOVLW	b'10100'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10100'
		MOVWF	PORTA
		CALL	ET
		;E
		CALL	Letter_E

		;blank space
		CALL	Blank_Space
		CALL	Blank_Space
		

		;1
		MOVLW	b'10011'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10001'
		MOVWF	PORTA
		CALL	ET
	
		CALL	Blank_Space
		CALL	Blank_Space
		
		;2
		MOVLW	b'10011'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10010'
		MOVWF	PORTA
		CALL	ET

		CALL	Blank_Space
		CALL	Blank_Space
		
		;3
		MOVLW	b'10011'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10011'
		MOVWF	PORTA
		CALL	ET
		
		;SET ADDRESS
		MOVLW	b'01000'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'00101'
		MOVWF	PORTA
		CALL	ET

		;Asterisk cursor (*)
		CALL	Asterisk

InfLoop	BTFSC	SCENE,3
		GOTO	InfLoop
		BTFSC	SCENE,2
		GOTO	MODE1
		BTFSC	SCENE,1
		GOTO	MODE2
		BTFSC	SCENE,0
		GOTO	MODE3
		GOTO	InfLoop


MODE1	CALL	INITIAL_CARDS
LO	GOTO	LO
MODE2
MODE3
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;; COMMONLY USED FUNCTIONS IN CODE ;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Clear_Display
		MOVLW	b'00000'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'00001'
		MOVWF	PORTA
		CALL	ET
		RETURN

Blank_Space
		MOVLW	b'11010'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10000'
		MOVWF	PORTA
		CALL	ET
		RETURN

Asterisk
		MOVLW	b'10010'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'11010'
		MOVWF	PORTA
		CALL	ET
		RETURN

Letter_O
		MOVLW	b'10100'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'11111'
		MOVWF	PORTA
		CALL	ET
		RETURN

Letter_M 
		MOVLW	b'10100'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'11101'
		MOVWF	PORTA
		CALL	ET
		RETURN

Letter_E
		MOVLW	b'10100'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'10101'
		MOVWF	PORTA
		CALL	ET
		RETURN

;TOGGLE
ET		BSF		PORTB,1
		NOP
		BCF		PORTB,1
		Call	DELAY
		RETURN


SET_AST
		;Set Address
		MOVF	tempA1,w
		MOVWF 	PORTA
		CALL  	ET
		MOVF	tempA2,w
		MOVWF 	PORTA
		CALL  	ET

		CALL 	Blank_Space

		;Set Address
		MOVF	tempB1,w
		MOVWF 	PORTA
		CALL 	ET
		MOVF	tempB2,w
		MOVWF 	PORTA
		CALL 	ET
		
		CALL 	Asterisk
		RETURN	


BOX		MOVLW	b'11101'
		MOVWF 	PORTA
		CALL 	ET
		MOVLW	b'11011'
		MOVWF 	PORTA
		CALL 	ET	
		RETURN


INITIAL_CARDS
		;DISPLAY ON/OFF (activating cursor)
		MOVLW	b'00000'
		MOVWF	PORTA
		CALL	ET
		MOVLW	b'01110'
		MOVWF	PORTA
		CALL	ET

		CALL	Clear_Display
		
		
		;Set Address
		MOVLW	b'01000'
		MOVWF 	PORTA
		CALL 	ET
		MOVLW	b'00000'
		MOVWF 	PORTA
		CALL 	ET	

		CALL	UTILITY
		
		;Set Address
		MOVLW	b'01100'
		MOVWF 	PORTA
		CALL 	ET
		MOVLW	b'00000'
		MOVWF 	PORTA
		CALL 	ET
		
		CALL	UTILITY
		
		;Set Address
		MOVLW	b'01000'
		MOVWF 	PORTA
		CALL 	ET
		MOVLW	b'00000'
		MOVWF 	PORTA
		CALL 	ET
		

		CLRF	AC

		RETURN

UTILITY	MOVLW	d'6'
		MOVWF	COUNTER
L		CALL	BOX
		DECFSZ	COUNTER
		GOTO	L
		RETURN


PLAY_GAME
		BTFSS	PORTB,5
		GOTO	RIGHT
		BTFSS	PORTB,4
		GOTO	LEFT
		BTFSS	PORTB,6
		GOTO	UP_DOWN
		GOTO	DONE

RIGHT	MOVLW	b'01000'
		BTFSC	AC,7
		ADDLW	b'100'
		MOVWF	PORTA
		CALL	ET
		MOVLW	d'1'
		ADDWF	AC
		MOVF	AC,w
		MOVWF	PORTA
		CALL	ET
		GOTO	DONE

LEFT	MOVLW	b'01000'
		BTFSC	AC,7
		ADDLW	b'100'
		MOVWF	PORTA
		CALL	ET
		MOVLW	d'1'
		SUBWF	AC
		MOVF	AC,w
		MOVWF	PORTA
		CALL	ET
		GOTO 	DONE


UP_DOWN	MOVLW	b'01000'
		MOVWF	PORTA
		BTFSS	AC,7
		BSF		PORTA,2
		BTFSC	AC,7
		BCF		PORTA,2
		CALL	ET

		MOVLW	b'10000000'
		XORWF	AC
		MOVF	AC,w
		MOVWF	PORTA
		CALL	ET

DONE		RETURN
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; DELAYS ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;1.5 ms delay
DELAY	MOVLW	h'00'
		MOVWF	COUNT1
		MOVLW	d'2'
		MOVWF	COUNT2
LOOP	INCFSZ	COUNT1,F
		GOTO	LOOP
		DECFSZ	COUNT2,F
		GOTO 	LOOP
		RETURN

;40 MS DELAY
DELAY2	MOVLW	h'00'
		MOVWF	COUNT1
		MOVLW	d'52'
		MOVWF	COUNT2
LOOP2	INCFSZ	COUNT1,F
		GOTO	LOOP2
		DECFSZ	COUNT2,F
		GOTO 	LOOP2
		RETURN


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;; INTERRUPTS ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

RBINT	CALL	DELAY
		BTFSC	SCENE,3
		GOTO	MENUINT
		BTFSC	SCENE,2
		GOTO	MODE1INT
		BTFSC	SCENE,1
		GOTO	MODE2INT
		BTFSC	SCENE,0
		GOTO	MODE3INT

MENUINT	BTFSS	PORTB,7
		GOTO	CHECK_MODE
		BTFSS	PORTB,5
		GOTO	MOVE_AST
		GOTO	LEAVEINT1

CHECK_MODE
		MOVLW	d'4'
		MOVWF	SCENE
		MOVF AC,w
		MOVWF c1
		MOVLW d'6'
		SUBWF c1
		BTFSC STATUS,Z
		GOTO LEAVEINT1

  		MOVLW	d'2'
		MOVWF	SCENE
		MOVF AC,w
		MOVWF c1
		MOVLW d'9'
		SUBWF c1
		BTFSC STATUS,Z
		GOTO LEAVEINT1

  		MOVLW	d'1'
		MOVWF	SCENE
		GOTO LEAVEINT1
		
MOVE_AST	
		MOVF AC,w
		MOVWF c1
		MOVLW d'12'
		SUBWF c1
		BTFSC STATUS,Z
		GOTO AT_3

		MOVF AC,w
		MOVWF c1
		MOVLW d'9'
		SUBWF c1
		BTFSC STATUS,Z
		GOTO AT_2
  
		MOVF AC,w
		MOVWF c1
		MOVLW d'6'
		SUBWF c1
		BTFSC STATUS,Z
		GOTO AT_1
		GOTO LEAVEINT1


AT_3	MOVLW d'6'
		MOVWF AC
		MOVLW	b'01000'
		MOVWF	tempA1
  		MOVLW	b'01011'
		MOVWF	tempA2
		MOVLW	b'01000'
		MOVWF	tempB1
		MOVLW	b'00101'
		MOVWF	tempB2
		CALL	SET_AST

		GOTO LEAVEINT1

AT_2	MOVLW d'12'
		MOVWF AC
		MOVLW	b'01000'
		MOVWF	tempA1
  		MOVLW	b'01000'
		MOVWF	tempA2
		MOVLW	b'01000'
		MOVWF	tempB1
		MOVLW	b'01011'
		MOVWF	tempB2
		CALL	SET_AST
  
		GOTO LEAVEINT1
  
AT_1	MOVLW d'9'
		MOVWF AC
 		MOVLW	b'01000'
		MOVWF	tempA1
  		MOVLW	b'00101'
		MOVWF	tempA2
		MOVLW	b'01000'
		MOVWF	tempB1
		MOVLW	b'01000'
		MOVWF	tempB2
		CALL	SET_AST
		
		GOTO 	LEAVEINT1
  
MODE1INT
		CALL	PLAY_GAME
		GOTO 	LEAVEINT1
MODE2INT
MODE3INT

LEAVEINT1	BCF		INTCON,RBIF
			RETFIE
	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
end
	
	
	
	
		
